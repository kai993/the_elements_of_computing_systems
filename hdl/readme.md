# ハードウェア記述言語 (HDL)
- ハードウェア記述言語(HDL)を用いると、回路を定義しテストを行うことが可能

## 規則
- 拡張子
  - `Xxx.hdl`というファイルになる
- 回路構造
  - ヘッダとボディの2つの要素から構成される
  - ヘッダでは回路のインターフェイスについて指定する
  - ボディでは実装が記される
- 構文
  - 大文字と小文字を区別する。キーワードは大文字で書かれる
- 命名規則
  - 英語と数字の羅列であれば良い
  - 数字から始まる名前は除く
  - 慣例として回路の名前は大文字で初め、ピンの名前は小文字で始める
- 空白スペース
  - スペース、改行、コメントは無視される
- コメント

    次のフォーマットがある
    ```hdl
    // 行末までのコメント
    /* 結びまでのコメント */
    /** API ドキュメント用のコメント */
    ```

## 回路ヘッダ
ヘッダは次のフォーマットに従う
```hdl
CHIP chip name {
  IN input pin name, input pin name, ... ;
  OUT output pin name, output pin name, ... ;
  // body
}
```

- CHIP宣言

    `CHIP`というキーワードの次に回路の名前が続く

- 入力ピン

    `IN`キーワードの次に、入力ピンの名前のリストがコンマで区切られた形で続く。最後はセミコロンで終わる

- 出力ピン

    `OUT`キーワードの次に、入力ピンの名前のリストがコンマで区切られた形で続く。最後はセミコロンで終わる

## 回路ボディ（実装）
### パーツ
一般的な回路は複数の下位レベルの回路から構成される。
それらの下位レベル回路の入力・出力ピンがあるロジックにしたがって互いにい接続され、機能を持つようになる。
フォーマット
```hdl
PARTS;
internal chip part;
internal chip part;
...
internal chip part;
```

`internal chip part`の部分は次の構文にしたがって記述される。
```hdl
chip name (connection, ..., connection);;
```

`connection`構文

```hdl
part's pin names = chip's pin name
```

### ピンと接続
- `connection`では、パーツのピンが他のピンとどのように接続するか、ということを記述している。
- 単純な場合はパーツのピンを回路の入力ピンもしくは出力ピンにそのまま出力する。

#### 内部ピン
あるパーツの出力ピンを別のパーツの入力ピンに繋げるためには内部ピンを作成しないといけない

```hdl
Part1 (..., out=v);    // Part1のoutはvへ送信される
Part2 (in=v, ...);     // vはPart2のinへ送信される
Part3 (a=v, b=v, ...); // vはPart3のaとb両方に送信される
```

#### 入力ピン
パーツの入力ピンは次に示すソースのうちいずれかから送信される。
- 回路の入力ピン
- 内部ピン
- 定数である `true` か `false`

#### 出力ピン
パーツの出力ピンは次のどちらかへ送信される。
- 回路の出力ピン
- 内部ピン

### バス
接続部分で使われるピンは多ビットバス(multibit bus)を用いることができる。
多ビットバスの入力ピンや出力ピンの各ビットに接続するためには、`x[i]`や`x[i...j]=v`のような記述を用いる。

```hdl
CHIP Foo {
  IN in[8]   // 8ビット入力
  OUT out[8] // 8ビット出力
  // Foo回路のボディ部分
}
```

## ビルトイン回路
HDLはビルトイン回路のライブラリを持っている。
ビルトイン回路のHDL定義
```hdl
/** 16ビットのマルチプレクサ。
sel=0の場合out=1, それ以外はout=b。
本回路は外部Javaクラスによるビルトイン版の実装が行われている。 */
CHIP Mux16 {
  IN a[16], a[16], sel;
  OUT out[16];
  BUILTIN Mux; // builtInChips/Mux.classを参照
               // Mux.classにはビルトイン回路のMux.hdlと
               // Mux16.hdlの実装が含まれる
}
```

## 順序回路
コンピュータで使用する回路は、組み合わせ回路か順序回路のどちらかである。

### クロック
- シュミレータは時間の進行をモデル化するために、`tick`と`tock`という2つの操作を用いる。
- これらの操作は、一連のタイムユニット(time unit)をシュミレートするために用いられる。
  - 第1フェーズ(tick)でアーキテクチャ内に存在する順序回路への入力は読み込まれ、回路のロジックに従い回路の内部状態に影響を与える。
  - 第2フェーズ(tock)で回路の出力が新しい値に設定される。

### クロック回路とピン
ビルトインの回路は、クロックに依存していることを宣言するために、次の構文を用いる。

```hdl
CLOCKED pin, pin, ..., pin;
```

## ハードウェアシュミレータ・チュートリアル
https://inworks.ucdenver.edu/jkb/iwks3300/Docs/Hardware%20Simulator%20Tutorial-JKB.pdf

